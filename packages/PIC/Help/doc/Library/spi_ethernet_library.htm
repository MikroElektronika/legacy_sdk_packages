
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

<head>

<title>SPI Ethernet Library</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="Copyright" content="mikroElektronika 2007.">
<meta name="Author" content="Marko Jovanovic & Marko Zivanovic. mailto:office@mikroe.com">

<link rel="stylesheet" type="text/css" href="css/help_c_PIC.css">
<script defer type="text/javascript" src="css/pngfix.js"></script>


	








<style type="text/css">
#top {
  background:transparent url(template/background_PIC.png); 
}

.title{
	PADDING-RIGHT: 2px; 
	PADDING-LEFT: 70px; 
	FONT-WEIGHT: bold; 
	FONT-SIZE: 14px; 
	PADDING-BOTTOM: 3px; 
	PADDING-TOP: 0px; 
	FONT-FAMILY: Verdana;
  color:white;
}

.navigation{
                     PADDING-TOP: -5px;
	PADDING-RIGHT: 2px; 
	PADDING-LEFT: 63px; 
	FONT-SIZE: 11px; 
	FONT-FAMILY: Verdana;
                     color:white;
}

.navigation a:link {text-decoration: none; color: white;}
.navigation a:visited {text-decoration: none; color: white;}
.navigation a:active {text-decoration: none; color: white;}
.navigation a:hover {text-decoration: none; color: white; background:black;}

.nav_bar {
}

#top td p,td pre {
	margin:0 0 0 0;
}
</style>

<style type="text/css" media="screen">
#main{
	border-top: 1px solid #000000;
  padding-left: 15px;
  padding-right: 15px;
	position: absolute;
	top: 59px;
	right: 0px;
	bottom: 0px;
	left: 0px;

	width: expression(document.body.offsetWidth - 3);
	height: expression(document.body.offsetHeight -  65);
	overflow: auto;
}
</style>

</head>


<body>

<div id="top">
<table height="60" width="100%">
  <tbody>
	  <tr>
		  <td>
			  <pre class="nav_bar"><div class="title">SPI Ethernet Library</div><div class="navigation">&nbsp;&nbsp;<A href="index.htm">mikroC PRO for PIC Libraries</A> &gt; <A href="mikroC_PRO_hardware_libraries.htm">Hardware Libraries</A> &gt; </div></pre>
			</td>
		  <td style="WIDTH: 120px" align="right">
			  <pre class="nav_bar"><A href="spi_library.htm" title="Previous"><img src="template\btn_prev_n.png" border="0"></a>&nbsp;<A title="Top of the Page" href="#top_of_page" alt="Top of the Page"><IMG src="template/btn_up_n.png" border=0 ></a>&nbsp;<A href="spi_ethernet_24j600_library.htm" title="Next"><img src="template\btn_next_n.png" border="0"></a></pre>
			</td>
		</tr>
	</tbody>
</table>
</div>

	


  <div id="main">


    <a name="top_of_page"><h2>SPI Ethernet ENC28J60 Library</h2></a>

		<p>The <code>ENC28J60</code> is a stand-alone Ethernet controller with an industry standard Serial Peripheral Interface (SPI). 
		  It is designed to serve as an Ethernet network interface for any controller equipped with <acronym title="Serial Peripheral Interface">SPI</acronym>. </p>
		<p>The <code>ENC28J60</code> meets all of the <acronym title="Institute of Electrical and Electronics Engineers">IEEE</acronym> 802.3 specifications. It incorporates a number of packet filtering
			schemes to limit incoming packets. It also provides an internal <acronym title="Direct Memory Access">DMA</acronym> module for fast data throughput and hardware
			assisted <acronym title="Internet Protocol">IP</acronym> checksum calculations. Communication with the host controller is implemented via two interrupt pins and the <acronym title="Serial Peripheral Interface">SPI</acronym>, with data rates of up to 10 Mb/s. Two dedicated pins are used for <acronym title="Light Emitting Diode">LED</acronym> link and network activity indication.</p>
			
    <p>This library is designed to simplify handling of the underlying hardware (<code>ENC28J60</code>). It works with any PIC with  
    	 integrated <acronym title="Serial Peripheral Interface">SPI</acronym> and more than 4 Kb ROM memory. 38 to 40 MHz clock is recommended to get from 8 to 10 Mhz <acronym title="Serial Peripheral Interface">SPI</acronym> 
    	 clock, otherwise PIC should be clocked by <code>ENC28J60</code> clock output due to its silicon bug in <acronym title="Serial Peripheral Interface">SPI</acronym> hardware. If you try 
    	 lower PIC clock speed, there might be board hang or miss some requests.</p> 
    
    <p>
    	SPI Ethernet ENC28J60 Library supports:    
    	<ul>
    		<li>IPv4 protocol.</li>
    		<li><acronym title="Address Resolution Protocol">ARP</acronym> requests.</li>
    		<li><acronym title="Internet Control Message Protocol">ICMP</acronym> echo requests.</li>
    		<li><acronym title="User Datagram Protocol">UDP</acronym> requests.</li>
    		<li><acronym title="Transmission Control Protocol">TCP</acronym> requests (no stack, no packet reconstruction).</li>
    		<li><acronym title="Address Resolution Protocol">ARP</acronym> client with cache.</li>
    		<li><acronym title="Domain Name Server">DNS</acronym> client.</li>
    		<li><acronym title="User Datagram Protocol">UDP</acronym> client.</li>
    		<li><acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> client.</li>
    		<li>packet fragmentation is <b>NOT</b> supported.</li>
      </ul>
    </p>
 
    <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
	    <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Important :</b>      
      <ul>
        <li>Due to PIC16 <acronym title="Random Access Memory">RAM</acronym>/Flash limitations PIC16 library does <b>NOT</b> have <acronym title="Address Resolution Protocol">ARP</acronym>, <acronym title="Domain Name Server">DNS</acronym>, <acronym title="User Datagram Protocol">UDP</acronym> and <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> client support implemented.</li>
        <li>Global library variable <code>SPI_Ethernet_userTimerSec</code> is used to keep track of time for all client implementations (<acronym title="Address Resolution Protocol">ARP</acronym>, <acronym title="Domain Name Server">DNS</acronym>, <acronym title="User Datagram Protocol">UDP</acronym> and <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>). It is user responsibility to increment this variable each second in it's code if any of the clients is used.</li>
        <li>For advanced users there are header files (<code>"__EthEnc28j60.h"</code> and <code>"__EthEnc28j60Private.h"</code>) in Uses\P16 and Uses\P18 folders of the compiler with description of all routines and global variables, relevant to the user, implemented in the SPI Ethernet ENC28J60 Library.</li>
        <li>The appropriate hardware <acronym title="Serial Peripheral Interface">SPI</acronym> module must be initialized before using any of the SPI Ethernet ENC28J60 library routines. Refer to <a href="spi_library.htm">SPI Library</a>.</li>
        <li>For MCUs with two SPI modules it is possible to initialize both of them and then switch by using the <code>SPI_Set_Active()</code> routine.</li>
      </ul>
    </div> 

    <p></p>
    <h3>Library Dependency Tree</h3>
    <p></p>
    <img alt="SPI Ethernet ENC28J60 Library Dependency Tree" src="img/dependencies/spiethernet_dependency.gif">  
    <p></p>

    <p></p>
    <h3>External dependencies of SPI Ethernet ENC28J60 Library</h3>


    <!-- tabela: Ext_depend -->

    <table class="Dependencies" width="75%">

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="40%">The following variables must be defined in all projects using SPI Ethernet ENC28J60 Library:</th>
          <th width="30%">Description: </th>
          <th width="30%">Examples : </th>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <td><code><b>extern sfr sbit</b> SPI_Ethernet_CS;<code></td>
          <td>ENC28J60 chip select pin.</td>
          <td><code><b>sbit</b> SPI_Ethernet_CS <b>at</b> RC1_bit;</code></td>
        </tr>
 
         <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <td><code><b>extern sfr sbit</b> SPI_Ethernet_RST;</code></td>
          <td>ENC28J60 reset pin.</td>
          <td><code><b>sbit</b> SPI_Ethernet_Rst <b>at</b> RC0_bit;</code></td>
        </tr>
             
        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <td><code><b>extern sfr sbit</b> SPI_Ethernet_CS_Direction;<code></td>
          <td>Direction of the ENC28J60 chip select pin.</td>
          <td><code><b>sbit</b> SPI_Ethernet_CS_Direction <b>at</b> TRISC1_bit;</code></td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <td><code><b>extern sfr sbit</b> SPI_Ethernet_RST_Direction;</code></td>
          <td>Direction of the ENC28J60 reset pin.</td>
          <td><code><b>sbit</b> SPI_Ethernet_Rst_Direction <b>at</b> TRISC0_bit;</code></td>
        </tr>
        
      </tbody>

    </table>
    <p></p>
    <table class="Dependencies" width="75%" >

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="40%">The following routines must be defined in all project using SPI Ethernet ENC28J60 Library:</th>
          <th width="30%">Description: </th>
          <th width="30%">Examples : </th>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
      		<td><code><b>unsigned int</b> SPI_Ethernet_UserTCP(<b>unsigned char</b> *remoteHost,
                               <b>unsigned int</b> remotePort,
                               <b>unsigned int</b> localPort,
                               <b>unsigned int</b> reqLength,
                               <b>TEthPktFlags</b> *flags);</code></td>
          <td>TCP request handler.</td>
          <td>Refer to the library example at the bottom of this page for code implementation.</td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <td><code><b>unsigned int</b> SPI_Ethernet_UserUDP(<b>unsigned char</b> *remoteHost,
                                  <b>unsigned int</b> remotePort,
                                  <b>unsigned int</b> localPort,
                                  <b>unsigned int</b> reqLength,
                                  <b>TEthPktFlags</b> *flags);</code></td>
          <td>UDP request handler.</td>
          <td>Refer to the library example at the bottom of this page for code implementation.</td>
        </tr>
        
      </tbody>

    </table>

    <!-- kraj tabele -->


    <!-- -->


    <h3>Library Routines</h3>
	  <h4>PIC16 and PIC18:</h4>
	    <ul>
	    	<li><a href="#spi_ethernet_init">SPI_Ethernet_Init</a></li>
	    	<li><a href="#spi_ethernet_enable">SPI_Ethernet_Enable</a></li>
	    	<li><a href="#spi_ethernet_disable">SPI_Ethernet_Disable</a></li>
	    	<li><a href="#spi_ethernet_dopacket">SPI_Ethernet_doPacket</a></li>
	    	<li><a href="#spi_ethernet_putbyte">SPI_Ethernet_putByte</a></li>		
	    	<li><a href="#spi_ethernet_putbytes">SPI_Ethernet_putBytes</a></li>
	    	<li><a href="#spi_ethernet_putstring">SPI_Ethernet_putString</a></li>
	    	<li><a href="#spi_ethernet_putconststring">SPI_Ethernet_putConstString</a></li>
	    	<li><a href="#spi_ethernet_putconstbytes">SPI_Ethernet_putConstBytes</a></li>
	    	<li><a href="#spi_ethernet_getbyte">SPI_Ethernet_getByte</a></li>	
	    	<li><a href="#spi_ethernet_getbytes">SPI_Ethernet_getBytes</a></li>	
	    	<li><a href="#spi_ethernet_usertcp">SPI_Ethernet_UserTCP</a></li>	
	    	<li><a href="#spi_ethernet_userudp">SPI_Ethernet_UserUDP</a></li>			
	    </ul>	
		<h4>PIC18 Only:</h4>
			<ul>
	    	<li><a href="#spi_ethernet_getipaddress">SPI_Ethernet_getIpAddress</a></li>
	    	<li><a href="#spi_ethernet_getgwipaddress">SPI_Ethernet_getGwIpAddress</a></li>
	    	<li><a href="#spi_ethernet_getdnsipaddress">SPI_Ethernet_getDnsIpAddress</a></li>
	    	<li><a href="#spi_ethernet_getipmask">SPI_Ethernet_getIpMask</a></li>
	    	<li><a href="#spi_ethernet_confnetwork">SPI_Ethernet_confNetwork</a></li>
	    	<li><a href="#spi_ethernet_arpresolve">SPI_Ethernet_arpResolve</a></li>
	    	<li><a href="#spi_ethernet_sendudp">SPI_Ethernet_sendUDP</a></li>
	    	<li><a href="#spi_ethernet_dnsresolve">SPI_Ethernet_dnsResolve</a></li>		
	    	<li><a href="#spi_ethernet_initdhcp">SPI_Ethernet_initDHCP</a></li>
	    	<li><a href="#spi_ethernet_dodhcpleasetime">SPI_Ethernet_doDHCPLeaseTime</a></li>
	    	<li><a href="#spi_ethernet_renewdhcp">SPI_Ethernet_renewDHCP</a></li>
	    </ul>	

    <!-- -->
    
    <h3 id="spi_ethernet_init">SPI_Ethernet_Init</h3>


    <!-- tabela: SPI_Ethernet_Init -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>void</b> SPI_Ethernet_Init(<b>unsigned char</b> *mac, <b>unsigned char</b> *ip, <b>unsigned char</b> fullDuplex);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>Nothing.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This is <acronym title="Media Access Control">MAC</acronym> module routine. It initializes <code>ENC28J60</code> controller. This function is internaly splited into 2 parts to help linker when coming short of memory.</p>
            <p>
            	<code>ENC28J60</code> controller settings (parameters not mentioned here are set to default):
            	<ul>
            		<li>receive buffer start address : <code>0x0000</code>.</li> 
            		<li>receive buffer end address	 : <code>0x19AD</code>.</li> 
            		<li>transmit buffer start address: <code>0x19AE</code>.</li> 
            		<li>transmit buffer end address	 : <code>0x1FFF</code>.</li> 
            		<li><acronym title="Random Access Memory">RAM</acronym> buffer read/write pointers in auto-increment mode.</li> 
            		<li>receive filters set to default: <acronym title="Cyclic Redundancy Check">CRC</acronym> + <acronym title="Media Access Control">MAC</acronym> Unicast + <acronym title="Media Access Control">MAC</acronym> Broadcast in OR mode.</li> 
            		<li>flow control with TX and RX pause frames in full duplex mode.</li> 
            		<li>frames are padded to <code>60</code> bytes + <acronym title="Cyclic Redundancy Check">CRC</acronym>.</li> 
            		<li>maximum packet size is set to <code>1518</code>.</li> 
            		<li>Back-to-Back Inter-Packet Gap: <code>0x15</code> in full duplex mode; <code>0x12</code> in half duplex mode.</li> 
            		<li>Non-Back-to-Back Inter-Packet Gap: <code>0x0012</code> in full duplex mode; <code>0x0C12</code> in half duplex mode.</li> 
            		<li>Collision window is set to <code>63</code> in half duplex mode to accomodate some <code>ENC28J60</code> revisions silicon bugs.</li> 
            		<li>CLKOUT output is disabled to reduce EMI generation.</li> 
            		<li>half duplex loopback disabled.</li> 
            		<li><acronym title="Light Emitting Diode">LED</acronym> configuration: default (LEDA-link status, LEDB-link activity).</li> 
              </ul>	
            </p>
          	<p>Parameters:</p>
            <ul>
                <li><code>mac:</code> <acronym title="Random Access Memory">RAM</acronym> buffer containing valid <acronym title="Media Access Control">MAC</acronym> address.</li>
	  			<li><code>ip:</code> <acronym title="Random Access Memory">RAM</acronym> buffer containing valid <acronym title="Internet Protocol">IP</acronym> address.</li>
	  			<li><code>fullDuplex:</code> ethernet duplex mode switch. Valid values: <code>0</code> (half duplex mode) and <code>1</code> (full duplex mode).</li> 
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            Global variables :
          	<ul>
          	  <li><code>SPI_Ethernet_CS</code>: Chip Select line
              <li><code>SPI_Ethernet_CS_Direction</code>: Direction of the Chip Select pin
          	  <li><code>SPI_Ethernet_RST</code>: Reset line
              <li><code>SPI_Ethernet_RST_Direction</code>: Direction of the Reset pin            
            </ul>

          	must be defined before using this function.
            <p><br>The <acronym title="Serial Peripheral Interface">SPI</acronym> module needs to be initialized.
          		 See the <a href="spi_library.htm#spi1_init">SPIx_Init</a> and <a href="spi_library.htm#spi1_init_advanced">SPIx_Init_Advanced</a> routines.        
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
#define SPI_Ethernet_HALFDUPLEX     0
#define SPI_Ethernet_FULLDUPLEX     1

<i>// mE ethernet NIC pinout</i>
<b>sfr sbit</b> SPI_Ethernet_Rst <b>at</b> RC0_bit;
<b>sfr sbit</b> SPI_Ethernet_CS  <b>at</b> RC1_bit;
<b>sfr sbit</b> SPI_Ethernet_Rst_Direction <b>at</b> TRISC0_bit;
<b>sfr sbit</b> SPI_Ethernet_CS_Direction  <b>at</b> TRISC1_bit;
<i>// end ethernet NIC definitions</i>

<b>unsigned char</b> myMacAddr[6] = {0x00, 0x14, 0xA5, 0x76, 0x19, 0x3f}; <i>// my MAC address</i>	
<b>unsigned char</b> myIpAddr     = {192, 168,   1, 60 };  <i>// my IP addr</i>

SPI1_Init();	
SPI_Ethernet_Init(myMacAddr, myIpAddr, SPI_Ethernet_FULLDUPLEX);</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->


    <!-- -->

    <h3 id="spi_ethernet_enable">SPI_Ethernet_Enable</h3>


    <!-- tabela: SPI_Ethernet_Enable -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>void</b> SPI_Ethernet_Enable(<b>unsigned char</b> enFlt);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>
            	Nothing.
            </p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This is <acronym title="Media Access Control">MAC</acronym> module routine. This routine enables appropriate network traffic on the <code>ENC28J60</code> module
            	 by the means of it's receive filters (unicast, multicast, broadcast, crc). Specific type of network traffic will be enabled if a corresponding bit of this routine's input parameter is set.
            	 Therefore, more than one type of network traffic can be enabled at the same time.
            	 For this purpose, predefined library constants (see the table below) can be ORed to form appropriate input value.
            <p>Parameters:</p>
            <ul>
              <li><code>enFlt:</code> network traffic/receive filter flags. Each bit corresponds to the appropriate network traffic/receive filter:</li>
							<p>
							  <table>
                  <tr align="center">
                  	<td><b>Bit</b></td>
										<td><b>Mask</b></td>
										<td><b>Description</b></td>
										<td><b>Predefined library const</b></td>
                  </tr>
									<tr align="center">
                  	<td>0</td>
										<td>0x01</td>
										<td><acronym title="Media Access Control">MAC</acronym> Broadcast traffic/receive filter flag. When set, <acronym title="Media Access Control">MAC</acronym> broadcast traffic will be enabled. </td>
										<td><code>_SPI_Ethernet_BROADCAST</code></td>
                  </tr>
									<tr align="center">
                  	<td>1</td>
										<td>0x02</td>
										<td><acronym title="Media Access Control">MAC</acronym> Multicast traffic/receive filter flag. When set, <acronym title="Media Access Control">MAC</acronym> multicast traffic will be enabled. </td>
										<td><code>_SPI_Ethernet_MULTICAST</code></td>
                  </tr>
									<tr align="center">
                  	<td>2</td>
										<td>0x04</td>
										<td>not used</td>
										<td>none</td>
                  </tr>
									<tr align="center">
                  	<td>3</td>
										<td>0x08</td>
										<td>not used</td>
										<td>none</td>
                  </tr>
									<tr align="center">
                  	<td>4</td>
										<td>0x10</td>
										<td>not used</td>
										<td>none</td>
                  </tr>
									<tr align="center">
                  	<td>5</td>
										<td>0x20</td>
										<td><acronym title="Cyclic Redundancy Check">CRC</acronym> check flag. When set, packets with invalid <acronym title="Cyclic Redundancy Check">CRC</acronym> field will be discarded.</td>
										<td><code>_SPI_Ethernet_CRC</code></td>
                  </tr>
									<tr align="center">
                  	<td>6</td>
										<td>0x40</td>
										<td>not used</td>
										<td>none</td>
                  </tr>
									<tr align="center">
                  	<td>7</td>
										<td>0x80</td>
										<td><acronym title="Media Access Control">MAC</acronym> Unicast traffic/receive filter flag. When set, <acronym title="Media Access Control">MAC</acronym> unicast traffic will be enabled. </td>
										<td><code>_SPI_Ethernet_UNICAST</code></td>
                  </tr>
                </table>
               <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">	  
                 <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
            	   <ul>
            		   <li>Advanced filtering available in the <code>ENC28J60</code> module such as <code>Pattern Match</code>, <code>Magic Packet</code> and <code>Hash Table</code> can not be enabled by this routine. Additionaly, all filters, except <acronym title="Cyclic Redundancy Check">CRC</acronym>, enabled with this routine will work in OR mode, which means that packet will be received if any of the enabled filters accepts it.</li>
            		   <li>This routine will change receive filter configuration on-the-fly. It will not, in any way, mess with enabling/disabling receive/transmit logic or any other part of the <code>ENC28J60</code> module. The <code>ENC28J60</code> module should be properly cofigured by the means of <a href="#spi_ethernet_init">SPI_Ethernet_Init</a> routine.</li>
            	   </ul>
               </div>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
SPI_Ethernet_Enable(_SPI_Ethernet_CRC | _SPI_Ethernet_UNICAST); <i>// enable CRC checking and Unicast traffic</i>
</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->

    <!-- -->

    <h3 id="spi_ethernet_disable">SPI_Ethernet_Disable</h3>


    <!-- tabela: SPI_Ethernet_Disable -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>void</b> SPI_Ethernet_Disable(<b>unsigned char</b> disFlt);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>
            	Nothing.</li>
            </p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This is <acronym title="Media Access Control">MAC</acronym> module routine. This routine disables appropriate network traffic on the <code>ENC28J60</code> module
            	 by the means of it's receive filters (unicast, multicast, broadcast, crc). Specific type of network traffic will be disabled if a corresponding bit of this routine's input parameter is set.
            	 Therefore, more than one type of network traffic can be disabled at the same time.
            	 For this purpose, predefined library constants (see the table below) can be ORed to form appropriate input value.
            <p>Parameters:</p>
            <ul>
              <li><code>disFlt:</code> network traffic/receive filter flags. Each bit corresponds to the appropriate network traffic/receive filter:</li>
							<p>
							  <table>
                  <tr align="center">
                  	<td><b>Bit</b></td>
										<td><b>Mask</b></td>
										<td><b>Description</b></td>
										<td><b>Predefined library const</b></td>
                  </tr>
									<tr align="center">
                  	<td>0</td>
										<td>0x01</td>
										<td><acronym title="Media Access Control">MAC</acronym> Broadcast traffic/receive filter flag. When set, <acronym title="Media Access Control">MAC</acronym> broadcast traffic will be disabled. </td>
										<td><code>_SPI_Ethernet_BROADCAST</code></td>
                  </tr>
									<tr align="center">
                  	<td>1</td>
										<td>0x02</td>
										<td><acronym title="Media Access Control">MAC</acronym> Multicast traffic/receive filter flag. When set, <acronym title="Media Access Control">MAC</acronym> multicast traffic will be disabled. </td>
										<td><code>_SPI_Ethernet_MULTICAST</code></td>
                  </tr>
									<tr align="center">
                  	<td>2</td>
										<td>0x04</td>
										<td>not used</td>
										<td>none</td>
                  </tr>
									<tr align="center">
                  	<td>3</td>
										<td>0x08</td>
										<td>not used</td>
										<td>none</td>
                  </tr>
									<tr align="center">
                  	<td>4</td>
										<td>0x10</td>
										<td>not used</td>
										<td>none</td>
                  </tr>
									<tr align="center">
                  	<td>5</td>
										<td>0x20</td>
										<td><acronym title="Cyclic Redundancy Check">CRC</acronym> check flag. When set, <acronym title="Cyclic Redundancy Check">CRC</acronym> check will be disabled and packets with invalid <acronym title="Cyclic Redundancy Check">CRC</acronym> field will be accepted.</td>
										<td><code>_SPI_Ethernet_CRC</code></td>
                  </tr>
									<tr align="center">
                  	<td>6</td>
										<td>0x40</td>
										<td>not used</td>
										<td>none</td>
                  </tr>
									<tr align="center">
                  	<td>7</td>
										<td>0x80</td>
										<td><acronym title="Media Access Control">MAC</acronym> Unicast traffic/receive filter flag. When set, <acronym title="Media Access Control">MAC</acronym> unicast traffic will be disabled. </td>
										<td><code>_SPI_Ethernet_UNICAST</code></td>
                  </tr>
                </table>
                <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
                  <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
                  <ul>
                	  <li>Advanced filtering available in the <code>ENC28J60</code> module such as <code>Pattern Match</code>, <code>Magic Packet</code> and <code>Hash Table</code> can not be disabled by this routine.</li>
                	  <li>This routine will change receive filter configuration on-the-fly. It will not, in any way, mess with enabling/disabling receive/transmit logic or any other part of the <code>ENC28J60</code> module.</li>
                	  <li>The <code>ENC28J60</code> module should be properly cofigured by the means of <a href="#spi_ethernet_init">SPI_Ethernet_Init</a> routine.</li>
                  </ul>
                </div>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
SPI_Ethernet_Disable(_SPI_Ethernet_CRC | _SPI_Ethernet_UNICAST); <i>// disable CRC checking and Unicast traffic</i>
</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->    
    
    <!-- -->

    <h3 id="spi_ethernet_dopacket">SPI_Ethernet_doPacket</h3>


    <!-- tabela: SPI_Ethernet_doPacket -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>unsigned char</b> SPI_Ethernet_doPacket();</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>
            	<ul>
            		<li><code>0</code> - upon successful packet processing (zero packets received or received packet processed successfully).</li>
            		<li><code>1</code> - upon reception error or receive buffer corruption. <code>ENC28J60</code> controller needs to be restarted.</li>
            		<li><code>2</code> - received packet was not sent to us (not our <acronym title="Internet Protocol">IP</acronym>, nor <acronym title="Internet Protocol">IP</acronym> broadcast address).</li>
            		<li><code>3</code> - received <acronym title="Internet Protocol">IP</acronym> packet was not IPv4.</li>
            		<li><code>4</code> - received packet was of type unknown to the library.</li>
              </ul>		
            </p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This is <acronym title="Media Access Control">MAC</acronym> module routine. It processes next received packet if such exists. Packets are processed in the following manner:</p>
            <ul>
              <li><acronym title="Address Resolution Protocol">ARP</acronym> & <acronym title="Internet Control Message Protocol">ICMP</acronym> requests are replied automatically.</li>
              <li>upon <acronym title="Transmission Control Protocol">TCP</acronym> request the <a href="#spi_ethernet_usertcp">SPI_Ethernet_UserTCP</a> function is called for further processing.</li>
              <li>upon <acronym title="User Datagram Protocol">UDP</acronym> request the <a href="#spi_ethernet_userudp">SPI_Ethernet_UserUDP</a> function is called for further processing.</li>
            </ul>
            <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
              <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
              <code>SPI_Ethernet_doPacket</code> must be called as often as possible in user's code.
            </div>            
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
<b>if</b> (SPI_Ethernet_doPacket() == 0)(1) {  <i>// process received packets</i>
  ...
}</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->

    <!-- -->  

    <h3 id="spi_ethernet_putbyte">SPI_Ethernet_putByte</h3>


    <!-- tabela: SPI_Ethernet_putByte -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>void</b> SPI_Ethernet_putByte(<b>unsigned char</b> v);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>Nothing.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This is <acronym title="Media Access Control">MAC</acronym> module routine. It stores one byte to address pointed by the current <code>ENC28J60</code> write pointer (<code>EWRPT</code>).
            </p>
            <p>Parameters:</p>
            <ul>
              <li><code>v:</code> value to store</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
<b>char</b> data_;
...
SPI_Ethernet_putByte(data);<i> // put an byte into ENC28J60 buffer</i>
</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->

    <!-- -->  

    <h3 id="spi_ethernet_putbytes">SPI_Ethernet_putBytes</h3>


    <!-- tabela: SPI_Ethernet_putBytes -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
          	<p><b>void</b> SPI_Ethernet_putBytes(<b>unsigned char</b> *ptr, <b>unsigned int</b> n);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>Nothing.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This is <acronym title="Media Access Control">MAC</acronym> module routine. It stores requested number of bytes into <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym> starting from current <code>ENC28J60</code> write pointer (<code>EWRPT</code>) location.</p>
						<p>Parameters:</p>
            <ul>
              <li><code>ptr:</code> <acronym title="Random Access Memory">RAM</acronym> buffer containing bytes to be written into <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym>.</li>
			  			<li><code>n:</code> number of bytes to be written.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
<b>char</b> *buffer =  "mikroElektronika";	 
...
SPI_Ethernet_putBytes(buffer, 16); <i>// put an RAM array into ENC28J60 buffer</i></pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->    
    
    <!-- -->  

    <h3 id="spi_ethernet_putconstbytes">SPI_Ethernet_putConstBytes</h3>


    <!-- tabela: SPI_Ethernet_putConstBytes -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
          	<p><b>void</b> SPI_Ethernet_putConstBytes(<b>const unsigned char</b> *ptr, <b>unsigned int</b> n);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>Nothing.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This is <acronym title="Media Access Control">MAC</acronym> module routine. It stores requested number of const bytes into <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym> starting from current <code>ENC28J60</code> write pointer (<code>EWRPT</code>) location.</p>
						<p>Parameters:</p>
            <ul>
              <li><code>ptr:</code> const buffer containing bytes to be written into <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym>.</li>
			  			<li><code>n:</code> number of bytes to be written.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
<b>const char</b> *buffer =  "mikroElektronika";	 
...
SPI_Ethernet_putConstBytes(buffer, 16); <i>// put a const array into ENC28J60 buffer</i>
</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->    
    
		<!-- -->  

    <h3 id="spi_ethernet_putstring">SPI_Ethernet_putString</h3>


    <!-- tabela: SPI_Ethernet_putString -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
          	<p><b>unsigned int</b> SPI_Ethernet_putString(<b>unsigned char</b> *ptr);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>Number of bytes written into <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This is <acronym title="Media Access Control">MAC</acronym> module routine. It stores whole string (excluding null termination) into <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym> starting from current <code>ENC28J60</code> write pointer (<code>EWRPT</code>) location.</p>
						<p>Parameters:</p>
            <ul>
              <li><code>ptr:</code> string to be written into <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym>.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
<b>char</b> *buffer =  "mikroElektronika";	 
...
SPI_Ethernet_putString(buffer); <i>// put a RAM string into ENC28J60 buffer</i>
</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->    

        
		<!-- -->  

    <h3 id="spi_ethernet_putconststring">SPI_Ethernet_putConstString</h3>


    <!-- tabela: SPI_Ethernet_putConstString -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
          	<p><b>unsigned int</b> SPI_Ethernet_putConstString(<b>const unsigned char</b> *ptr);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>Number of bytes written into <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This is <acronym title="Media Access Control">MAC</acronym> module routine. It stores whole const string (excluding null termination) into <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym> starting from current <code>ENC28J60</code> write pointer (<code>EWRPT</code>) location.</p>
						<p>Parameters:</p>
            <ul>
              <li><code>ptr:</code> const string to be written into <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym>.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
<b>const char</b> *buffer =  "mikroElektronika"; 
...
SPI_Ethernet_putConstString(buffer); <i>// put a const string into ENC28J60 buffer</i>
</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->       

		<!-- -->  

    <h3 id="spi_ethernet_getbyte">SPI_Ethernet_getByte</h3>


    <!-- tabela: SPI_Ethernet_getByte -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>unsigned char</b> SPI_Ethernet_getByte();</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>Byte read from <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This is <acronym title="Media Access Control">MAC</acronym> module routine. It fetches a byte from address pointed to by current <code>ENC28J60</code> read pointer (<code>ERDPT</code>).</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
<b>char</b> buffer; 
...
buffer = SPI_Ethernet_getByte(); <i>// read a byte from ENC28J60 buffer</i>
</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->
    
    <!-- -->  

    <h3 id="spi_ethernet_getbytes">SPI_Ethernet_getBytes</h3>


    <!-- tabela: SPI_Ethernet_putBytes -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
          	<p><b>void</b> SPI_Ethernet_getBytes(<b>unsigned char</b> *ptr, <b>unsigned int</b> addr, <b>unsigned int</b> n);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>Nothing.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This is <acronym title="Media Access Control">MAC</acronym> module routine. It fetches equested number of bytes from <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym> starting from given address. If value of <code>0xFFFF</code> is passed as the address parameter, the reading will start
                  from current <code>ENC28J60</code> read pointer (<code>ERDPT</code>) location.</p>
						<p>Parameters:</p>
            <ul>
              <li><code>ptr:</code> buffer for storing bytes read from <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym>.</li>
              <li><code>addr:</code> <code>ENC28J60</code> <acronym title="Random Access Memory">RAM</acronym> start address. Valid values: <code>0</code>..<code>8192</code>.</li>
			  			<li><code>n:</code> number of bytes to be read.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
<b>char</b> buffer[16];	 
...
SPI_Ethernet_getBytes(buffer, 0x100, 16); <i>// read 16 bytes, starting from address 0x100</i>
</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->        

    <!-- -->
    
    <h3 id="spi_ethernet_usertcp">SPI_Ethernet_UserTCP</h3>


    <!-- tabela: SPI_Ethernet_UserTCP -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>unsigned int</b> SPI_Ethernet_UserTCP(<b>unsigned char</b> *remoteHost, <b>unsigned int</b> remotePort, <b>unsigned int</b> localPort, <b>unsigned int</b> reqLength, <b>TEthPktFlags</b> *flags);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>
						  <ul>
							  <li><code>0</code> - there should not be a reply to the request.</li>
								<li>Length of <acronym title="Transmission Control Protocol">TCP</acronym>/<acronym title="Hypertext Transfer Protocol">HTTP</acronym> reply data field - otherwise.</li>
              </ul>						
						</p>
						
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>
						   This is <acronym title="Transmission Control Protocol">TCP</acronym> module routine. It is internally called by the library. The user accesses to the <acronym title="Transmission Control Protocol">TCP</acronym>/<acronym title="Hypertext Transfer Protocol">HTTP</acronym> request by using some of the 
						   SPI_Ethernet_get routines. The user puts data in the transmit buffer by using some of the SPI_Ethernet_put routines.
						   The function must return the length in bytes of the <acronym title="Transmission Control Protocol">TCP</acronym>/<acronym title="Hypertext Transfer Protocol">HTTP</acronym> reply, or 0 if there is nothing to transmit. 
						   If there is no need to reply to the <acronym title="Transmission Control Protocol">TCP</acronym>/<acronym title="Hypertext Transfer Protocol">HTTP</acronym> requests, just define this function with return(0) as a single 
						   statement.            	
            </p>
            <p>Parameters:</p>
            <ul>
              <li><code>remoteHost:</code> client's <acronym title="Internet Protocol">IP</acronym> address.</li>
              <li><code>remotePort:</code> client's <acronym title="Transmission Control Protocol">TCP</acronym> port.</li>
              <li><code>localPort:</code> port to which the request is sent.</li>
              <li><code>reqLength:</code> <acronym title="Transmission Control Protocol">TCP</acronym>/<acronym title="Hypertext Transfer Protocol">HTTP</acronym> request data field length.</li>
              <li><code>flags:</code> structure consisted of two bit fields : 

<div class="example">
  <textarea style="display:none;"></textarea> 
  <span class="copytoclipboard"><a onclick="copyToClipboard(this); return false;" href="#"><img align="absmiddle" alt="Copy Code To Clipboard" src="img/copy_to_clipboard.png" border="0" /><span class="clipboard_text">Copy Code To Clipboard</span></a></span>
</div>

<pre class="program"><b>typedef struct</b> {
  <b>unsigned</b> canCloseTCP: 1;  <i>// flag which closes socket</i>
  <b>unsigned</b> isBroadcast: 1;  <i>// flag which denotes that the IP package has been received via subnet broadcast address (not used for PIC16 family)</i>
} TEthPktFlags;
</pre>
            </ul>
            <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
              <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
              The function source code is provided with appropriate example projects. The code should be adjusted by the user to achieve desired reply.
            </div>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">


	<p>This function is internally called by the library and should not be called by the user's code.</p>


          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->

    <!-- -->         
    
    <h3 id="spi_ethernet_userudp">SPI_Ethernet_UserUDP</h3>


    <!-- tabela: SPI_Ethernet_UserUDP -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>unsigned int</b> SPI_Ethernet_UserUDP(<b>unsigned char</b> *remoteHost, <b>unsigned int</b> remotePort, <b>unsigned int</b> destPort, <b>unsigned int</b> reqLength, <b>TEthPktFlags</b> *flags);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	<p>
          		<ul> 
	          	  <li><code>0</code> - there should not be a reply to the request.</li>
							  <li>Length of <acronym title="User Datagram Protocol">UDP</acronym> reply data field - otherwise.</li>
							</ul>  
						</p>	
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>
							 This is <acronym title="User Datagram Protocol">UDP</acronym> module routine. It is internally called by the library. The user accesses to the <acronym title="User Datagram Protocol">UDP</acronym> request by using some of the 
						   SPI_Ethernet_get routines. The user puts data in the transmit buffer by using some of the SPI_Ethernet_put routines.
						   The function must return the length in bytes of the <acronym title="User Datagram Protocol">UDP</acronym> reply, or 0 if nothing to transmit. 
						   If you don't need to reply to the <acronym title="User Datagram Protocol">UDP</acronym> requests, just define this function with a return(0) as single 
						   statement.
					  </p><p>Parameters:</p>
            <ul>
              <li><code>remoteHost:</code> client's <acronym title="Internet Protocol">IP</acronym> address.</li>
              <li><code>remotePort:</code> client's port.</li>
              <li><code>destPort:</code> port to which the request is sent.</li>
              <li><code>flags:</code> structure consisted of two bit fields : 

<div class="example">
  <textarea style="display:none;"></textarea> 
  <span class="copytoclipboard"><a onclick="copyToClipboard(this); return false;" href="#"><img align="absmiddle" alt="Copy Code To Clipboard" src="img/copy_to_clipboard.png" border="0" /><span class="clipboard_text">Copy Code To Clipboard</span></a></span>
</div>

<pre class="program"><b>typedef struct</b> {
  <b>unsigned</b> canCloseTCP: 1;  <i>// flag which closes TCP socket (not relevant to UDP)</i>
  <b>unsigned</b> isBroadcast: 1;  <i>// flag which denotes that the IP package has been received via subnet broadcast address (not used for PIC16 family)</i>
} TEthPktFlags;
</pre>
            <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
              <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
              The function source code is provided with appropriate example projects. The code should be adjusted by the user to achieve desired reply.
            </div>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<p>This function is internally called by the library and should not be called by the user's code.</p>


          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->

		<!-- -->         
    
    <h3 id="spi_ethernet_getipaddress">SPI_Ethernet_getIpAddress</h3>


    <!-- tabela: SPI_Ethernet_getIpAddress -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>unsigned char</b> * SPI_Ethernet_getIpAddress();<p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	Pointer to the global variable holding <acronym title="Internet Protocol">IP</acronym> address.
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This routine should be used when <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> server is present on the network to fetch assigned <acronym title="Internet Protocol">IP</acronym> address.</p>
            <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
              <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
              User should always copy the <acronym title="Internet Protocol">IP</acronym> address from the <acronym title="Random Access Memory">RAM</acronym> location returned by this routine into it's own <acronym title="Internet Protocol">IP</acronym> address buffer. These locations should not be altered by the user in any case!
            </div>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
            <p>Available for PIC18 family <acronym title="MicroController Unit">MCU</acronym>s only.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">
<pre>
<b>unsigned char</b> ipAddr[4];  <i>// user IP address buffer</i>
...	
memcpy(ipAddr, SPI_Ethernet_getIpAddress(), 4); <i>// fetch IP address</i>
</pre>
          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->  
    
		<!-- -->         
    
    <h3 id="spi_ethernet_getgwipaddress">SPI_Ethernet_getGwIpAddress</h3>


    <!-- tabela: SPI_Ethernet_getGwIpAddress -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>unsigned char</b> * SPI_Ethernet_getGwIpAddress();<p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	Pointer to the global variable holding gateway <acronym title="Internet Protocol">IP</acronym> address.
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This routine should be used when <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> server is present on the network to fetch assigned gateway <acronym title="Internet Protocol">IP</acronym> address.</p>
            <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
              <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
              User should always copy the <acronym title="Internet Protocol">IP</acronym> address from the <acronym title="Random Access Memory">RAM</acronym> location returned by this routine into it's own gateway <acronym title="Internet Protocol">IP</acronym> address buffer. These locations should not be altered by the user in any case!
            </div>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
            <p>Available for PIC18 family <acronym title="MicroController Unit">MCU</acronym>s only.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">
<pre>
<b>unsigned char</b> gwIpAddr[4];  <i>// user gateway IP address buffer</i>
...	
memcpy(gwIpAddr, SPI_Ethernet_getGwIpAddress(), 4); <i>// fetch gateway IP address </i>
</pre>
          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->      
    
		<!-- -->         
    
    <h3 id="spi_ethernet_getdnsipaddress">SPI_Ethernet_getDnsIpAddress</h3>


    <!-- tabela: SPI_Ethernet_getDnsIpAddress -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>unsigned char</b> * SPI_Ethernet_getDnsIpAddress()<p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	Pointer to the global variable holding <acronym title="Domain Name Server">DNS</acronym> <acronym title="Internet Protocol">IP</acronym> address.
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>his routine should be used when <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> server is present on the network to fetch assigned <acronym title="Domain Name Server">DNS</acronym> <acronym title="Internet Protocol">IP</acronym> address.</p>
            <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
              <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
              User should always copy the <acronym title="Internet Protocol">IP</acronym> address from the <acronym title="Random Access Memory">RAM</acronym> location returned by this routine into it's own <acronym title="Domain Name Server">DNS</acronym> <acronym title="Internet Protocol">IP</acronym> address buffer. These locations should not be altered by the user in any case!
            </div>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
            <p>Available for PIC18 family <acronym title="MicroController Unit">MCU</acronym>s only.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">
<pre>
<b>unsigned char</b> dnsIpAddr[4];  <i>// user DNS IP address buffer</i>
...	
memcpy(dnsIpAddr, SPI_Ethernet_getDnsIpAddress(), 4); <i>// fetch DNS server address </i>
</pre>
          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->            

		<!-- -->         
    
    <h3 id="spi_ethernet_getipmask">SPI_Ethernet_getIpMask</h3>


    <!-- tabela: SPI_Ethernet_getIpMask -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>unsigned char</b> * SPI_Ethernet_getIpMask()<p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	Pointer to the global variable holding <acronym title="Internet Protocol">IP</acronym> subnet mask.
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>This routine should be used when <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> server is present on the network to fetch assigned <acronym title="Internet Protocol">IP</acronym> subnet mask.</p>
            <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
              <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
              User should always copy the <acronym title="Internet Protocol">IP</acronym> address from the <acronym title="Random Access Memory">RAM</acronym> location returned by this routine into it's own <acronym title="Internet Protocol">IP</acronym> subnet mask buffer. These locations should not be altered by the user in any case!
            </div>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
            <p>Available for PIC18 family <acronym title="MicroController Unit">MCU</acronym>s only.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">
<pre>
<b>unsigned char</b> IpMask[4];  <i>// user IP subnet mask buffer</i>
...	
memcpy(IpMask, SPI_Ethernet_getIpMask(), 4); <i>// fetch IP subnet mask</i>
</pre>
          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->                
    
    <!-- -->         
    
    <h3 id="spi_ethernet_confnetwork">SPI_Ethernet_confNetwork</h3>


    <!-- tabela: SPI_Ethernet_confNetwork -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>void</b> SPI_Ethernet_confNetwork(<b>char</b> *ipMask, <b>char</b> *gwIpAddr, <b>char</b> *dnsIpAddr);<p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	Nothing.
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>Configures network parameters (<acronym title="Internet Protocol">IP</acronym> subnet mask, gateway <acronym title="Internet Protocol">IP</acronym> address, <acronym title="Domain Name Server">DNS</acronym> <acronym title="Internet Protocol">IP</acronym> address) when <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> is not used.</p>
					  <p>Parameters:</p>
            <ul>
              <li><code>ipMask:</code>  <acronym title="Internet Protocol">IP</acronym> subnet mask.</li>
              <li><code>gwIpAddr</code> gateway <acronym title="Internet Protocol">IP</acronym> address.</li>
              <li><code>dnsIpAddr:</code> <acronym title="Domain Name Server">DNS</acronym> <acronym title="Internet Protocol">IP</acronym> address.</li>
            </ul>
            <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
              <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
              The above mentioned network parameters should be set by this routine only if <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> module is not used. Otherwise <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> will override these settings.</p>
            </div>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
            <p>Available for PIC18 family <acronym title="MicroController Unit">MCU</acronym>s only.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">
<pre>
<b>char</b> ipMask[4]    = {255, 255, 255,  0 };  <i>// network mask (for example : 255.255.255.0)</i>
<b>char</b> gwIpAddr[4]  = {192, 168,   1,  1 };  <i>// gateway (router) IP address</i>
<b>char</b> dnsIpAddr[4] = {192, 168,   1,  1 };  <i>// DNS server IP address</i>
...	
SPI_Ethernet_confNetwork(ipMask, gwIpAddr, dnsIpAddr); <i>// set network configuration parameters</i>
</pre>
          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->    

    <!-- -->         
    
    <h3 id="spi_ethernet_arpresolve">SPI_Ethernet_arpResolve</h3>


    <!-- tabela: SPI_Ethernet_arpResolve -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>unsigned char</b>   *SPI_Ethernet_arpResolve(<b>unsigned char</b> *ip, <b>unsigned char</b> tmax);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	<ul>
          		<li><acronym title="Media Access Control">MAC</acronym> address behind the <acronym title="Internet Protocol">IP</acronym> address - the requested <acronym title="Internet Protocol">IP</acronym> address was resolved.</li>
          		<li><code>0</code> - otherwise.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>
							This is <acronym title="Address Resolution Protocol">ARP</acronym> module routine. It sends an <acronym title="Address Resolution Protocol">ARP</acronym> request for given <acronym title="Internet Protocol">IP</acronym> address and waits for <acronym title="Address Resolution Protocol">ARP</acronym> reply. 
							If the requested <acronym title="Internet Protocol">IP</acronym> address was resolved, an <acronym title="Address Resolution Protocol">ARP</acronym> cash entry is used for storing the configuration.
							<acronym title="Address Resolution Protocol">ARP</acronym> cash can store up to 3 entries. For <acronym title="Address Resolution Protocol">ARP</acronym> cash structure refer to <code>"eth_enc28j60LibDef.h"</code> header file in the compiler's Uses/P18 folder.</p>
					  <p>Parameters:</p>
            <ul>
              <li><code>ip:</code>  <acronym title="Internet Protocol">IP</acronym> address to be resolved.</li>
              <li><code>tmax:</code> time in seconds to wait for an reply.</li>
            </ul>
            <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
              <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
              The Ethernet services are not stopped while this routine waits for <acronym title="Address Resolution Protocol">ARP</acronym> reply. The incoming packets will be processed normaly during this time.
            </div>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
            <p>Available for PIC18 family <acronym title="MicroController Unit">MCU</acronym>s only.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">
<pre>
<b>unsigned char</b> IpAddr[4]  = {192, 168,   1,  1 };  <i>// IP address</i>
...	
SPI_Ethernet_arpResolve(IpAddr, 5); <i>// get MAC address behind the above IP address, wait 5 secs for the response</i>
</pre>
          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->     
    
    <!-- -->         
    
    <h3 id="spi_ethernet_sendudp">SPI_Ethernet_sendUDP</h3>


    <!-- tabela: SPI_Ethernet_sendUDP -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
          	<p><b>unsigned char</b> SPI_Ethernet_sendUDP(<b>unsigned char</b> *destIP, <b>unsigned int</b> sourcePort, <b>unsigned int</b> destPort, <b>unsigned char</b> *pkt, <b>unsigned int</b> pktLen); </p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	<ul>
          		<li><code>1</code> - <acronym title="User Datagram Protocol">UDP</acronym> packet was sent successfully.</li>
          		<li><code>0</code> - otherwise.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>
							This is <acronym title="User Datagram Protocol">UDP</acronym> module routine. It sends an <acronym title="User Datagram Protocol">UDP</acronym> packet on the network. 
						</p>
					  <p>Parameters:</p>
            <ul>
              <li><code>destIP:</code>  remote host <acronym title="Internet Protocol">IP</acronym> address.</li>
              <li><code>sourcePort:</code> local <acronym title="User Datagram Protocol">UDP</acronym> source port number.</li>
              <li><code>destPort:</code>  destination <acronym title="User Datagram Protocol">UDP</acronym> port number.</li>
              <li><code>pkt:</code> packet to transmit.</li>
              <li><code>pktLen:</code> length in bytes of packet to transmit.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
            <p>Available for PIC18 family <acronym title="MicroController Unit">MCU</acronym>s only.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">
<pre>
<b>unsigned char</b> IpAddr[4]  = {192, 168,   1,  1 };  <i>// remote IP address</i>
...	
SPI_Ethernet_sendUDP(IpAddr, 10001, 10001, "Hello", 5); <i>// send Hello message to the above IP address, from UDP port 10001 to UDP port 10001</i> 
</pre>
          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->        
    
    <!-- -->         
    
    <h3 id="spi_ethernet_dnsresolve">SPI_Ethernet_dnsResolve</h3>


    <!-- tabela: SPI_Ethernet_dnsResolve -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
          	<p><b>unsigned char</b>	* SPI_Ethernet_dnsResolve(<b>unsigned char</b> *host, <b>unsigned char</b> tmax);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	<ul>
          		<li>pointer to the location holding the <acronym title="Internet Protocol">IP</acronym> address - the requested host name was resolved.</li>
          		<li><code>0</code> - otherwise.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>
							This is <acronym title="Domain Name Server">DNS</acronym> module routine. It sends an <acronym title="Domain Name Server">DNS</acronym> request for given host name and waits for <acronym title="Domain Name Server">DNS</acronym> reply.
							If the requested host name was resolved, it's <acronym title="Internet Protocol">IP</acronym> address is stored in library global variable 
							and a pointer containing this address is returned by the routine. <acronym title="User Datagram Protocol">UDP</acronym> port <code>53</code> is used as <acronym title="Domain Name Server">DNS</acronym> port.</p>
					  <p>Parameters:</p>
            <ul>
              <li><code>host:</code> host name to be resolved.</li>
              <li><code>tmax:</code> time in seconds to wait for an reply.</li>
            </ul>
            <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
              <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
						  <ul>
						  	<li>The Ethernet services are not stopped while this routine waits for <acronym title="Domain Name Server">DNS</acronym> reply. The incoming packets will be processed normaly during this time.</li>
						  	<li>User should always copy the <acronym title="Internet Protocol">IP</acronym> address from the <acronym title="Random Access Memory">RAM</acronym> location returned by this routine into it's own resolved host <acronym title="Internet Protocol">IP</acronym> address buffer. These locations should not be altered by the user in any case!</p></li>
						  </ul>
						</div>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
            <p>Available for PIC18 family <acronym title="MicroController Unit">MCU</acronym>s only.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">
<pre>
<b>unsigned char</b> * remoteHostIpAddr[4];	<i>// user host IP address buffer</i>
...
<i>// SNTP server:
// Zurich, Switzerland: Integrated Systems Lab, Swiss Fed. Inst. of Technology
// 129.132.2.21: swisstime.ethz.ch
// Service Area: Switzerland and Europe	</i>
memcpy(remoteHostIpAddr, SPI_Ethernet_dnsResolve("swisstime.ethz.ch", 5), 4);
</pre>
          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->            
    
    <!-- -->         
    
    <h3 id="spi_ethernet_initdhcp">SPI_Ethernet_initDHCP</h3>


    <!-- tabela: SPI_Ethernet_initDHCP -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
          	<p><b>unsigned char</b> SPI_Ethernet_initDHCP(<b>unsigned char</b> tmax);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	<ul>
          		<li><code>1</code> - network parameters were obtained successfully.</li>
          		<li><code>0</code> - otherwise.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>
							This is <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> module routine. It sends an <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> 
							request for network parameters (<acronym title="Internet Protocol">IP</acronym>, gateway, <acronym title="Domain Name Server">DNS</acronym> addresses and <acronym title="Internet Protocol">IP</acronym> subnet mask) and waits for <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> reply.
						  If the requested parameters were obtained successfully, their values are stored into the library global variables. </p>
							<p>These parameters can be fetched by using appropriate library <acronym title="Internet Protocol">IP</acronym> get routines:</p>
							<ul>
								<li><a href="#spi_ethernet_getipaddress">SPI_Ethernet_getIpAddress</a> - fetch <acronym title="Internet Protocol">IP</acronym> address.</li> 
								<li><a href="#spi_ethernet_getgwipaddress">SPI_Ethernet_getGwIpAddress</a> - fetch gateway <acronym title="Internet Protocol">IP</acronym> address.</li> 
								<li><a href="#spi_ethernet_getdnsipaddress">SPI_Ethernet_getDnsIpAddress</a> - fetch <acronym title="Domain Name Server">DNS</acronym> <acronym title="Internet Protocol">IP</acronym> address.</li> 
								<li><a href="#spi_ethernet_getipmask">SPI_Ethernet_getIpMask</a> - fetch <acronym title="Internet Protocol">IP</acronym> subnet mask.</li> 
						  </ul>		
							<p><acronym title="User Datagram Protocol">UDP</acronym> port <code>68</code> is used as <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> client port and
							<acronym title="User Datagram Protocol">UDP</acronym> port <code>67</code> is used as <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> server port.</p>
						</p>		
					  <p>Parameters:</p>
            <ul>
              <li><code>tmax:</code> time in seconds to wait for an reply.</li>
            </ul>
            <div style="border: 1.00pt solid #cccccc; padding: 5.00pt; background: #f5f2ec">
              <img src="img/note.gif" align="absmiddle"><b>&nbsp;&nbsp;Note :</b>
						  <ul>
							  <li>The Ethernet services are not stopped while this routine waits for <acronym title="Domain Name Server">DNS</acronym> reply. The incoming packets will be processed normaly during this time.</li>
							  <li>When <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> module is used, global library variable <code>SPI_Ethernet_userTimerSec</code> is used to keep track of time. It is user responsibility to increment this variable each second in it's code.</li>
						  </ul>   
            </div>
					</td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
            <p>Available for PIC18 family <acronym title="MicroController Unit">MCU</acronym>s only.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">
<pre>
...	
SPI_Ethernet_initDHCP(5); <i>// get network configuration from DHCP server, wait 5 sec for the response</i> 
...
</pre>
          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->                
    
    <!-- -->         
    
    <h3 id="spi_ethernet_dodhcpleasetime">SPI_Ethernet_doDHCPLeaseTime</h3>


    <!-- tabela: SPI_Ethernet_doDHCPLeaseTime -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
          	<p><b>unsigned char</b> SPI_Ethernet_doDHCPLeaseTime();</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	<ul>
          		<li><code>0</code> - lease time has not expired yet.</li>
          		<li><code>1</code> - lease time has expired, it's time to renew it.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>
						This is <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> module routine. It takes care of <acronym title="Internet Protocol">IP</acronym> address lease time by decrementing the global lease time library counter.
						When this time expires, it's time to contact <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> server and renew the lease.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
            <p>Available for PIC18 family <acronym title="MicroController Unit">MCU</acronym>s only.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">
<pre>
<b>while</b>(1) {	
  ...
  <b>if</b>(SPI_Ethernet_doDHCPLeaseTime())
    ... <i>// it's time to renew the IP address lease</i>                  
}
</pre>
          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->           
    
    <!-- -->         
    
    <h3 id="spi_ethernet_renewdhcp">SPI_Ethernet_renewDHCP</h3>


    <!-- tabela: SPI_Ethernet_renewDHCP -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
          	<p><b>unsigned char</b> SPI_Ethernet_renewDHCP(<b>unsigned char</b> tmax);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
          	<ul>
          		<li><code>1</code> - upon success (lease time was renewed).</li>
          		<li><code>0</code> - otherwise (renewal request timed out).</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>
						This is <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> module routine. It sends <acronym title="Internet Protocol">IP</acronym> address lease time renewal request to <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> server.
						<p>Parameters:</p>
            <ul>
              <li><code>tmax:</code> time in seconds to wait for an reply.</li>
            </ul>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Ethernet module has to be initialized. See <a href="#spi_ethernet_init">SPI_Ethernet_Init</a>.</p>
            <p>Available for PIC18 family <acronym title="MicroController Unit">MCU</acronym>s only.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">
<pre>
<b>while</b>(1) {	
  ...
  <b>if</b>(SPI_Ethernet_doDHCPLeaseTime())
    SPI_Ethernet_renewDHCP(5); <i>// it's time to renew the IP address lease, with 5 secs for a reply</i>                  
  ...  
}
</pre>
          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->                  
    
    <!-- -->

    <h3>Library Example</h3>

    <p>This code shows how to use the Ethernet mini library :
    	<ul>
        <li>       the board will reply to ARP & ICMP echo requests</li>
        <li>       the board will reply to UDP requests on any port :</li>
                       <ul>
                       	 <li>returns the request in upper char with a header made of remote host IP & port number</li>
                       </ul>	 
        <li>       the board will reply to HTTP requests on port 80, GET method with pathnames :</li>
                       <ul>
                       	 <li>/               will return the HTML main page</li>
                         <li>/s              will return board status as text string</li>
                         <li>/t0 ... /t7     will toggle RD0 to RD7 bit and return HTML main page</li>
                         <li>all other requests return also HTML main page.</li>
                       </ul>
      </ul>
    </p>
    
<div class="example">
  <textarea style="display:none;"></textarea> 
  <span class="copytoclipboard"><a onclick="copyToClipboard(this); return false;" href="#"><img align="absmiddle" alt="Copy Code To Clipboard" src="img/copy_to_clipboard.png" border="0" /><span class="clipboard_text">Copy Code To Clipboard</span></a></span>
</div>

<pre class="program">
#include  &#34;__EthEnc28j60.h&#34;

<i>// duplex config flags</i>
#define Spi_Ethernet_HALFDUPLEX     0x00  <i>// half duplex</i>
#define Spi_Ethernet_FULLDUPLEX     0x01  <i>// full duplex
// mE ehternet NIC pinout</i>
<b>sfr sbit</b> SPI_Ethernet_Rst <b>at</b> RC0_bit;
<b>sfr sbit</b> SPI_Ethernet_CS  <b>at</b> RC1_bit;
<b>sfr sbit</b> SPI_Ethernet_Rst_Direction <b>at</b> TRISC0_bit;
<b>sfr sbit</b> SPI_Ethernet_CS_Direction  <b>at</b> TRISC1_bit;
<i>// end ethernet NIC definitions</i>

<i>/************************************************************
 * ROM constant strings
 */</i>
<b>const unsigned char</b> httpHeader[] = &#34;HTTP/1.1 200 OKnContent-type: &#34; ;  <i>// HTTP header</i>
<b>const unsigned char</b> httpMimeTypeHTML[] = &#34;text/htmlnn&#34; ;              <i>// HTML MIME type</i>
<b>const unsigned char</b> httpMimeTypeScript[] = &#34;text/plainnn&#34; ;           <i>// TEXT MIME type</i>
<b>unsigned char</b> httpMethod[] = &#34;GET /&#34;;
<i>/*
 * web page, splited into 2 parts :
 * when coming short of ROM, fragmented data is handled more efficiently by linker
 *
 * this HTML page calls the boards to get its status, and builds itself with javascript
 */</i>
<b>const char</b>    *indexPage =                   <i>// Change the IP address of the page to be refreshed</i>
&#34;&#60;meta http-equiv=&#34;refresh&#34; content=&#34;3;url=http:<i>//192.168.20.60&#34;&#62;</i>
&#60;HTML&#62;&#60;HEAD&#62;&#60;/HEAD&#62;&#60;BODY&#62;
&#60;h1&#62;PIC + ENC28J60 Mini Web Server&#60;/h1&#62;
&#60;a href=/&#62;Reload&#60;/a&#62;
&#60;script src=/s&#62;&#60;/script&#62;
&#60;table&#62;&#60;tr&#62;&#60;td valign=top&#62;&#60;table border=1 style=&#34;font-size:20px ;font-family: terminal ;&#34;&#62;
&#60;tr&#62;&#60;th colspan=2&#62;ADC&#60;/th&#62;&#60;/tr&#62;
&#60;tr&#62;&#60;td&#62;AN2&#60;/td&#62;&#60;td&#62;&#60;script&#62;document.write(AN2)&#60;/script&#62;&#60;/td&#62;&#60;/tr&#62;
&#60;tr&#62;&#60;td&#62;AN3&#60;/td&#62;&#60;td&#62;&#60;script&#62;document.write(AN3)&#60;/script&#62;&#60;/td&#62;&#60;/tr&#62;
&#60;/table&#62;&#60;/td&#62;&#60;td&#62;&#60;table border=1 style=&#34;font-size:20px ;font-family: terminal ;&#34;&#62;
&#60;tr&#62;&#60;th colspan=2&#62;PORTB&#60;/th&#62;&#60;/tr&#62;
&#60;script&#62;
var str,i;
str=&#34;&#34;;
<b>for</b>(i=0;i&#60;8;i++)
{str+=&#34;&#60;tr&#62;&#60;td bgcolor=pink&#62;BUTTON #&#34;+i+&#34;&#60;/td&#62;&#34;;
<b>if</b>(PORTB&#38;(1&#60;&#60;i)){str+=&#34;&#60;td bgcolor=red&#62;ON&#34;;}
<b>else</b> {str+=&#34;&#60;td bgcolor=#cccccc&#62;OFF&#34;;}
str+=&#34;&#60;/td&#62;&#60;/tr&#62;&#34;;}
document.write(str) ;
&#60;/script&#62;
&#34; ;

<b>const char</b>    *indexPage2 =  &#34;&#60;/table&#62;&#60;/td&#62;&#60;td&#62;
&#60;table border=1 style=&#34;font-size:20px ;font-family: terminal ;&#34;&#62;
&#60;tr&#62;&#60;th colspan=3&#62;PORTD&#60;/th&#62;&#60;/tr&#62;
&#60;script&#62;
var str,i;
str=&#34;&#34;;
<b>for</b>(i=0;i&#60;8;i++)
{str+=&#34;&#60;tr&#62;&#60;td bgcolor=yellow&#62;LED #&#34;+i+&#34;&#60;/td&#62;&#34;;
<b>if</b>(PORTD&#38;(1&#60;&#60;i)){str+=&#34;&#60;td bgcolor=red&#62;ON&#34;;}
<b>else</b> {str+=&#34;&#60;td bgcolor=#cccccc&#62;OFF&#34;;}
str+=&#34;&#60;/td&#62;&#60;td&#62;&#60;a href=/t&#34;+i+&#34;&#62;Toggle&#60;/a&#62;&#60;/td&#62;&#60;/tr&#62;&#34;;}
document.write(str) ;
&#60;/script&#62;
&#60;/table&#62;&#60;/td&#62;&#60;/tr&#62;&#60;/table&#62;
<b>This</b> is HTTP request #&#60;script&#62;document.write(REQ)&#60;/script&#62;&#60;/BODY&#62;&#60;/HTML&#62;
&#34; ;

<i>/***********************************
 * RAM variables
 */</i>
<b>unsigned char</b>   myMacAddr[6] = {0x00, 0x14, 0xA5, 0x76, 0x19, 0x3f} ;   <i>// my MAC address</i>
<b>unsigned char</b>   myIpAddr[4]  = {192, 168, 20, 60} ;                     <i>// my IP address</i>
<b>unsigned char</b>   getRequest[15] ;                                        <i>// HTTP request buffer</i>
<b>unsigned char</b>   dyna[30] ;                                              <i>// buffer for dynamic response</i>
<b>unsigned long</b>   httpCounter = 0 ;                                       <i>// counter of HTTP requests</i>

<i>/*******************************************
 * functions
 */</i>

<i>/*
 * put the constant string pointed to by s to the ENC transmit buffer.
 */
/*unsigned int    putConstString(const char *s)
        {
        unsigned int ctr = 0 ;

        while(*s)
                {
                Spi_Ethernet_putByte(*s++) ;
                ctr++ ;
                }
        return(ctr) ;
        }*/
/*
 * it will be much faster to use library Spi_Ethernet_putConstString routine
 * instead of putConstString routine above. However, the code will be a little
 * bit bigger. User should choose between size and speed and pick the implementation that
 * suites him best. If you choose to go with the putConstString definition above
 * the #define line below should be commented out.
 *
 */</i>
#define putConstString  SPI_Ethernet_putConstString

<i>/*
 * put the string pointed to by s to the ENC transmit buffer
 */
/*unsigned int    putString(char *s)
        {
        unsigned int ctr = 0 ;

        while(*s)
                {
                Spi_Ethernet_putByte(*s++) ;

                ctr++ ;
                }
        return(ctr) ;
        }*/
/*
 * it will be much faster to use library Spi_Ethernet_putString routine
 * instead of putString routine above. However, the code will be a little
 * bit bigger. User should choose between size and speed and pick the implementation that
 * suites him best. If you choose to go with the putString definition above
 * the #define line below should be commented out.
 *
 */</i>
#define putString  SPI_Ethernet_putString

<i>/*
 * this function is called by the library
 * the user accesses to the HTTP request by successive calls to Spi_Ethernet_getByte()
 * the user puts data in the transmit buffer by successive calls to Spi_Ethernet_putByte()
 * the function must return the length in bytes of the HTTP reply, or 0 if nothing to transmit
 *
 * if you don't need to reply to HTTP requests,
 * just define this function with a return(0) as single statement
 *
 */</i>
<b>unsigned int</b>  SPI_Ethernet_UserTCP(<b>unsigned char</b> *remoteHost, <b>unsigned int</b> remotePort, <b>unsigned int</b> localPort, <b>unsigned int</b> reqLength, TEthPktFlags *flags)
{
        <b>unsigned int</b>    len = 0 ;                   <i>// my reply length</i>
        <b>unsigned int</b>    i ;                         <i>// general purpose integer</i>

        <i>// should we close tcp socket after response is sent?</i>
        <i>// library closes tcp socket by default if canClose flag is not reset here</i>
        <i>// flags-&#62;canClose = 0; // 0 - do not close socket</i>
                          <i>// otherwise - close socket</i>

        <b>if</b>(localPort != 80)                         <i>// I listen only to web request on port 80</i>
                {
                <b>return</b>(0) ;
                }

        <i>// get 10 first bytes only of the request, the rest does not matter here</i>
        <b>for</b>(i = 0 ; i &#60; 10 ; i++)
                {
                getRequest[i] = SPI_Ethernet_getByte() ;
                }
        getRequest[i] = 0 ;

        <b>if</b>(memcmp(getRequest, httpMethod, 5))       <i>// only GET method is supported here</i>
                {
                <b>return</b>(0) ;
                }

        httpCounter++ ;                             <i>// one more request done</i>

        <b>if</b>(getRequest[5] == 's')                    <i>// if request path name starts with s, store dynamic data in transmit buffer</i>
                {
                <i>// the text string replied by this request can be interpreted as javascript statements</i>
                <i>// by browsers</i>

                len = putConstString(httpHeader) ;              <i>// HTTP header</i>
                len += putConstString(httpMimeTypeScript) ;     <i>// with text MIME type</i>

                <i>// add AN2 value to reply</i>
                IntToStr(ADC_Read(2), dyna) ;
                len += putConstString(&#34;var AN2=&#34;) ;
                len += putString(dyna) ;
                len += putConstString(&#34;;&#34;) ;

                <i>// add AN3 value to reply</i>
                IntToStr(ADC_Read(3), dyna) ;
                len += putConstString(&#34;var AN3=&#34;) ;
                len += putString(dyna) ;
                len += putConstString(&#34;;&#34;) ;

                <i>// add PORTB value (buttons) to reply</i>
                len += putConstString(&#34;var PORTB=&#34;) ;
                IntToStr(PORTB, dyna) ;
                len += putString(dyna) ;
                len += putConstString(&#34;;&#34;) ;

                <i>// add PORTD value (LEDs) to reply</i>
                len += putConstString(&#34;var PORTD=&#34;) ;
                IntToStr(PORTD, dyna) ;
                len += putString(dyna) ;
                len += putConstString(&#34;;&#34;) ;

                <i>// add HTTP requests counter to reply</i>
                IntToStr(httpCounter, dyna) ;
                len += putConstString(&#34;var REQ=&#34;) ;
                len += putString(dyna) ;
                len += putConstString(&#34;;&#34;) ;
                }
        <b>else if</b>(getRequest[5] == 't')                           <i>// if request path name starts with t, toggle PORTD (LED) bit number that comes after</i>
                {
                <b>unsigned char</b>   bitMask = 0 ;                   <i>// for bit mask</i>

                <b>if</b>(isdigit(getRequest[6]))                      <i>// if 0 &#60;= bit number &#60;= 9, bits 8 &#38; 9 does not exist but does not matter</i>
                        {
                        bitMask = getRequest[6] - '0' ;         <i>// convert ASCII to integer</i>
                        bitMask = 1 &#60;&#60; bitMask ;                <i>// create bit mask</i>
                        PORTD ^= bitMask ;                      <i>// toggle PORTD with xor operator</i>
                        }
                }

        <b>if</b>(len == 0)                                            <i>// what do to by default</i>
                {
                len =  putConstString(httpHeader) ;             <i>// HTTP header</i>
                len += putConstString(httpMimeTypeHTML) ;       <i>// with HTML MIME type</i>
                len += putConstString(indexPage) ;              <i>// HTML page first part</i>
                len += putConstString(indexPage2) ;             <i>// HTML page second part</i>
                }

        <b>return</b>(len) ;                                           <i>// return to the library with the number of bytes to transmit</i>
        }

<i>/*
 * this function is called by the library
 * the user accesses to the UDP request by successive calls to Spi_Ethernet_getByte()
 * the user puts data in the transmit buffer by successive calls to Spi_Ethernet_putByte()
 * the function must return the length in bytes of the UDP reply, or 0 if nothing to transmit
 *
 * if you don't need to reply to UDP requests,
 * just define this function with a return(0) as single statement
 *
 */</i>
<b>unsigned int</b>  SPI_Ethernet_UserUDP(<b>unsigned char</b> *remoteHost, <b>unsigned int</b> remotePort, <b>unsigned int</b> destPort, <b>unsigned int</b> reqLength, TEthPktFlags *flags)
        {
        <b>unsigned int</b>    len ;                           <i>// my reply length</i>

        <i>// reply is made of the remote host IP address in human readable format</i>
        ByteToStr(remoteHost[0], dyna) ;                <i>// first IP address byte</i>
        dyna[3] = '.' ;
        ByteToStr(remoteHost[1], dyna + 4) ;            <i>// second</i>
        dyna[7] = '.' ;
        ByteToStr(remoteHost[2], dyna + 8) ;            <i>// third</i>
        dyna[11] = '.' ;
        ByteToStr(remoteHost[3], dyna + 12) ;           <i>// fourth</i>

        dyna[15] = ':' ;                                <i>// add separator</i>

        <i>// then remote host port number</i>
        WordToStr(remotePort, dyna + 16) ;
        dyna[21] = '[' ;
        WordToStr(destPort, dyna + 22) ;
        dyna[27] = ']' ;
        dyna[28] = 0 ;

        <i>// the total length of the request is the length of the dynamic string plus the text of the request</i>
        len = 28 + reqLength;

        <i>// puts the dynamic string into the transmit buffer</i>
        SPI_Ethernet_putBytes(dyna, 28) ;

        <i>// then puts the request string converted into upper char into the transmit buffer</i>
        <b>while</b>(reqLength--)
                {
                SPI_Ethernet_putByte(toupper(SPI_Ethernet_getByte())) ;
                }

        <b>return</b>(len) ;           <i>// back to the library with the length of the UDP reply</i>
        }

<i>/*
 * main entry
 */</i>
<b>void</b>    main()
        {
        ANSEL = 0x0C ;          <i>// AN2 and AN3 convertors will be used</i>
        C1ON_bit = 0;           <i>// Disable comparators</i>
        C2ON_bit = 0;
        PORTA = 0 ;
        TRISA = 0xff ;          <i>// set PORTA as input for ADC</i>

        ANSELH = 0;             <i>// Configure other AN pins as digital I/O</i>
        PORTB = 0 ;
        TRISB = 0xff ;          <i>// set PORTB as input for buttons</i>

        PORTD = 0 ;
        TRISD = 0 ;             <i>// set PORTD as output</i>

        <i>/*
         * starts ENC28J60 with :
         * reset bit on RC0
         * CS bit on RC1
         * my MAC &#38; IP address
         * full duplex
         */</i>
        SPI1_Init();
        SPI_Ethernet_Init(myMacAddr, myIpAddr, Spi_Ethernet_FULLDUPLEX) ;

        <b>while</b>(1)                            <i>// do forever</i>
                {
                <i>/*
                 * if necessary, test the return value to get error code
                 */</i>
                SPI_Ethernet_doPacket() ;   <i>// process incoming Ethernet packets</i>

                <i>/*
                 * add your stuff here if needed
                 * Spi_Ethernet_doPacket() must be called as often as possible
                 * otherwise packets could be lost
                 */</i>
                }
        }
</pre>	    

    <h3>HW Connection</h3>

    <p class="center"><img src="img/schemes/scheme_spi_ethernet.gif" alt="SPI Ethernet ENC28J60 Connection Scheme"></p>

      <div class="feedback">
      Copyright (c) 2002-2019 mikroElektronika. All rights reserved.
      <br>What do you think about this topic ?  <a href="https://helpdesk.mikroe.com/conversation/new/3" target="_blank">Send us feedback!</a>
    </div>

    <div class="libstock">Want more examples and libraries?&nbsp;
     <br>Find them on
     <a href="http://www.libstock.com/" target="_blank"><img alt="LibStock - A place for the code" src="img/libstock.gif" border="0" align="absmiddle"></a>
    </div>

  </div><!--/main-->




</body>

</html>
