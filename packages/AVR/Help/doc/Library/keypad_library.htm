
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

<head>

<title>Keypad Library</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="Copyright" content="mikroElektronika 2006.">
<meta name="Author" content="Marko Jovanovic. mailto:office@mikroe.com">

<link rel="stylesheet" type="text/css" href="css/help_c_AVR.css">

<script defer type="text/javascript" src="css/pngfix.js"></script>


	






<link rel="stylesheet" type="text/css" href="css/print.css" media="print">


<style type="text/css">
#top {
  background:transparent url(template/c_avr.png); 
}

.title{
	PADDING-RIGHT: 2px; 
	PADDING-LEFT: 70px; 
	FONT-WEIGHT: bold; 
	FONT-SIZE: 14px; 
	PADDING-BOTTOM: 3px; 
	PADDING-TOP: 0px; 
	FONT-FAMILY: Verdana;
  color:white;
}

.navigation{
  PADDING-TOP: -5px;
	PADDING-RIGHT: 2px; 
	PADDING-LEFT: 63px; 
	FONT-SIZE: 11px; 
	FONT-FAMILY: Verdana;
  color:white;
}

.navigation a:link {text-decoration: none; color: white;}
.navigation a:visited {text-decoration: none; color: white;}
.navigation a:active {text-decoration: none; color: white;}
.navigation a:hover {text-decoration: none; color: white; background:black;}

.nav_bar {
}

#top td p,td pre {
	margin:0 0 0 0;
}
</style>

<style type="text/css" media="screen">
#main{
	border-top: 1px solid #000000;
  padding-left: 15px;
  padding-right: 15px;
	position: absolute;
	top: 59px;
	right: 0px;
	bottom: 0px;
	left: 0px;

	width: expression(document.body.offsetWidth - 3);
	height: expression(document.body.offsetHeight -  65);
	overflow: auto;
}
</style>

</head>


<body>

<div id="top">
<table height="60" width="100%">
  <tbody>
	  <tr>
		  <td>
			  <pre class="nav_bar"><div class="title">Keypad Library</div><div class="navigation">&nbsp;&nbsp;<A href="mikroc_PRO_libraries.htm">mikroC PRO for AVR Libraries</A> &gt; <A href="mikroC_PRO_hardware_libraries.htm">Hardware Libraries</A> &gt; </div></pre>
			</td>
		  <td style="WIDTH: 120px" align="right">
			  <pre class="nav_bar"><A href="graphic_lcd_library.htm" title="Previous"><img src="template\btn_prev_n.png" border="0"></a>&nbsp;<A title="Top of the Page" href="#top_of_page" alt="Top of the Page"><IMG src="template/btn_up_n.png" border=0 ></a>&nbsp;<A href="lcd_library.htm" title="Next"><img src="template\btn_next_n.png" border="0"></a></pre>
			</td>
		</tr>
	</tbody>
</table>
</div>

	





  <div id="main">


    <a name="top_of_page"><h2>Keypad Library</h2></a>


    <p>The mikroC PRO for AVR provides a library for working with 4x4 keypad. 
    	The library routines can also be used with 4x1, 4x2, or 4x3 keypad. 
    	For connections explanation see schematic at the bottom of this page.</p>

<!-- -->

<h3>External dependencies of Keypad Library</h3>


    <!-- tabela: Ext_depend -->

    <table class="Dependencies" width="75%">

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="40%">The following variable must be defined in all projects using Keypad Library:</th>
          <th width="30%">Description : </th>
          <th width="30%">Example : </th>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <td valign="center"><code><b>extern sfr char</b> keypadPort;</code></td>
          <td valign="center">Keypad Port.</td>
          <td valign="center"><code><b>char</b> keypadPort <b>at</b> PORTB;</code></td>
        </tr>
        
        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <td valign="center"><code><b>extern sfr char</b>  keypadPort_Direction;</code></td>
          <td valign="center">Direction of the Keypad Port.</td>
          <td valign="center"><code><b>char</b> keypadPort_Direction <b>at</b> DDRB;</code></td>
        </tr>
        
      </tbody>

    </table>

    <!-- kraj tabele -->


    <!-- -->


    <h3>Library Routines</h3>

    <ul>
      <li><a href="#keypad_init">Keypad_Init</a></li>
      <li><a href="#keypad_key_press">Keypad_Key_Press</a></li>
      <li><a href="#keypad_key_click">Keypad_Key_Click</a></li>
    </ul>


    <!-- -->


    <h3 id="keypad_init">Keypad_Init</h3>

    <!-- tabela: Keypad_Init -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>void</b> Keypad_Init(<b>void</b>);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>Nothing.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>Initializes port for working with keypad.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
          Global variables :
          <ul>
            <li><code>keypadPort</code> - Keypad port   
            <li><code>keypadPort_Direction</code> - Direction of the Keypad port
          </ul>
          must be defined before using this function.
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
<i>// Initialize PORTB for communication with keypad</i>
<b>char</b> keypadPort <b>at</b> PORTB;

<i>// Port direction</i>
<b>char</b>  keypadPort_Direction <b>at</b> DDRB;

<i>// Lcd module connections</i>
<b>sbit</b> LCD_RS <b>at</b> PORTD2_bit;
<b>sbit</b> LCD_EN <b>at</b> PORTD3_bit;
<b>sbit</b> LCD_D4 <b>at</b> PORTD4_bit;
<b>sbit</b> LCD_D5 <b>at</b> PORTD5_bit;
<b>sbit</b> LCD_D6 <b>at</b> PORTD6_bit;
<b>sbit</b> LCD_D7 <b>at</b> PORTD7_bit;

<b>sbit</b> LCD_RS_Direction <b>at</b> DDD2_bit;
<b>sbit</b> LCD_EN_Direction <b>at</b> DDD3_bit;
<b>sbit</b> LCD_D4_Direction <b>at</b> DDD4_bit;
<b>sbit</b> LCD_D5_Direction <b>at</b> DDD5_bit;
<b>sbit</b> LCD_D6_Direction <b>at</b> DDD6_bit;
<b>sbit</b> LCD_D7_Direction <b>at</b> DDD7_bit;
<i>// End Lcd module connections</i>
...
Keypad_Init();</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->


    <!-- -->


    <h3 id="keypad_key_press">Keypad_Key_Press</h3>


    <!-- tabela: Keypad_Read -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>char</b> Keypad_Key_Press(<b>void</b>);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>The code of a pressed key (1..16).</p>
            <p>If no key is pressed, returns 0.</p>            
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>Reads the key from keypad when key gets pressed.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Port needs to be initialized for working with the Keypad library, see <a href="#keypad_init">Keypad_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
<b>char</b> kp;
...
kp = Keypad_Key_Press();</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->


    <!-- -->


    <h3 id="keypad_key_click">Keypad_Key_Click</h3>


    <!-- tabela: Keypad_Released -->

    <table class="routine" width="100%">

      <!--
      <caption></caption>

      <thead></thead>
      -->

      <tbody>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th width="0" valign="top">Prototype</th>
          <td class="code" width="100%" valign="top">
            <p><b>char</b> Keypad_Key_Click(<b>void</b>);</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Returns</th>
          <td valign="top">
            <p>The code of a clicked key (1..16).</p>
            <p>If no key is clicked, returns 0.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Description</th>
          <td valign="top">
            <p>Call to <code>Keypad_Key_Click</code> is a blocking call: the function waits until some key is pressed and released. When released, the function returns 1 to 16, depending on the key.
            	If more than one key is pressed simultaneously the function will wait until all pressed keys are released.
            	 After that the function will return the code of the first pressed key.</p>
            
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Requires</th>
          <td valign="top">
            <p>Port needs to be initialized for working with the Keypad library, see <a href="#keypad_init">Keypad_Init</a>.</p>
          </td>
        </tr>

        <tr style="background:'white'" onmouseover="this.style.background='#f8f8f8';" onmouseout="this.style.background='white';">
          <th valign="top">Example</th>
          <td valign="top">

<pre>
<b>char</b> kp;
...
kp = Keypad_Key_Click();</pre>

          </td>
        </tr>

      </tbody>

    </table>

    <!-- kraj tabele -->


    <!-- -->


    <h3>Library Example</h3>
    <p>This is a simple example of using the Keypad Library. It supports keypads with 1..4 rows and 1..4 columns. The code being returned by
    	 Keypad_Key_Click() function is in range from 1..16. In this example, the code returned is transformed into ASCII codes [0..9,A..F] and displayed on Lcd.
       In addition, a small single-byte counter displays in the second Lcd row number of key presses.</p>

<div class="example">
  <textarea style="display:none;"></textarea> 
  <span class="copytoclipboard"><a onclick="copyToClipboard(this); return false;" href="#"><img align="absmiddle" alt="Copy Code To Clipboard" src="img/copy_to_clipboard.png" border="0" /><span class="clipboard_text">Copy Code To Clipboard</span></a></span>
</div>

<pre class="program">
<b>unsigned short</b> kp, cnt, oldstate = 0;
<b>char</b> txt[6];

<i>// Keypad module connections</i>
<b>char</b>  keypadPort <b>at</b> PORTB;
<b>char</b>  keypadPort_Direction <b>at</b> DDRB;
<i>// End Keypad module connections</i>

<i>// LCD module connections</i>
<b>sbit</b> LCD_RS <b>at</b> PORTD2_bit;
<b>sbit</b> LCD_EN <b>at</b> PORTD3_bit;
<b>sbit</b> LCD_D4 <b>at</b> PORTD4_bit;
<b>sbit</b> LCD_D5 <b>at</b> PORTD5_bit;
<b>sbit</b> LCD_D6 <b>at</b> PORTD6_bit;
<b>sbit</b> LCD_D7 <b>at</b> PORTD7_bit;

<b>sbit</b> LCD_RS_Direction <b>at</b> DDD2_bit;
<b>sbit</b> LCD_EN_Direction <b>at</b> DDD3_bit;
<b>sbit</b> LCD_D4_Direction <b>at</b> DDD4_bit;
<b>sbit</b> LCD_D5_Direction <b>at</b> DDD5_bit;
<b>sbit</b> LCD_D6_Direction <b>at</b> DDD6_bit;
<b>sbit</b> LCD_D7_Direction <b>at</b> DDD7_bit;
<i>// End LCD module connections</i>

<b>void</b> main() {
  cnt = 0;                                 <i>// Reset counter</i>
  Keypad_Init();                           <i>// Initialize Keypad                              </i>
  Lcd_Init();                              <i>// Initialize LCD</i>
  Lcd_Cmd(_LCD_CLEAR);                     <i>// Clear display</i>
  Lcd_Cmd(_LCD_CURSOR_OFF);                <i>// Cursor off</i>
  Lcd_Out(1, 1, &#34;1&#34;);
  Lcd_Out(1, 1, &#34;Key  :&#34;);                 <i>// Write message text on LCD</i>
  Lcd_Out(2, 1, &#34;Times:&#34;);

  <b>do</b> {
    kp = 0;                                <i>// Reset key code variable</i>

    <i>// Wait for key to be pressed and released</i>
    <b>do</b>
      <i>//kp = Keypad_Key_Press();             // Store key code in kp variable</i>
      kp = Keypad_Key_Click();             <i>// Store key code in kp variable</i>
    <b>while</b> (!kp);
   <i>// Prepare value for output, transform key to it's ASCII value</i>
    <b>switch</b> (kp) {
      <i>//case 10: kp = 42; break;  // '*'   // Uncomment this block for keypad4x3</i>
      <i>//case 11: kp = 48; break;  // '0'   </i>
      <i>//case 12: kp = 35; break;  // '#'</i>
      <i>//default: kp += 48;</i>

      <b>case</b>  1: kp = 49; <b>break</b>; <i>// 1        // Uncomment this block for keypad4x4</i>
      <b>case</b>  2: kp = 50; <b>break</b>; <i>// 2</i>
      <b>case</b>  3: kp = 51; <b>break</b>; <i>// 3</i>
      <b>case</b>  4: kp = 65; <b>break</b>; <i>// A</i>
      <b>case</b>  5: kp = 52; <b>break</b>; <i>// 4</i>
      <b>case</b>  6: kp = 53; <b>break</b>; <i>// 5</i>
      <b>case</b>  7: kp = 54; <b>break</b>; <i>// 6</i>
      <b>case</b>  8: kp = 66; <b>break</b>; <i>// B        </i>
      <b>case</b>  9: kp = 55; <b>break</b>; <i>// 7</i>
      <b>case</b> 10: kp = 56; <b>break</b>; <i>// 8</i>
      <b>case</b> 11: kp = 57; <b>break</b>; <i>// 9</i>
      <b>case</b> 12: kp = 67; <b>break</b>; <i>// C</i>
      <b>case</b> 13: kp = 42; <b>break</b>; <i>// *</i>
      <b>case</b> 14: kp = 48; <b>break</b>; <i>// 0</i>
      <b>case</b> 15: kp = 35; <b>break</b>; <i>// #</i>
      <b>case</b> 16: kp = 68; <b>break</b>; <i>// D</i>

    }

    <b>if</b> (kp != oldstate) {                  <i>// Pressed key differs from previous</i>
      cnt = 1;
      oldstate = kp;
    }
    <b>else</b> {                                 <i>// Pressed key is same as previous</i>
      cnt++;
    }

    Lcd_Chr(1, 10, kp);                    <i>// Print key ASCII value on LCD</i>

    <b>if</b> (cnt == 255) {                      <i>// If counter varialble overflow</i>
      cnt = 0;
      Lcd_Out(2, 10, &#34;   &#34;);
    }

    WordToStr(cnt, txt);                   <i>// Transform counter value to string</i>
    Lcd_Out(2, 10, txt);                   <i>// Display counter value on LCD</i>
  } <b>while</b> (1);
}</pre>


    <!-- -->


    <h3>HW Connection</h3>

    <p class="center"><img alt="4x4 Keypad connection scheme" src="img/schemes/scheme_keypad4x4.gif"></p>
    <p class="center small">4x4 Keypad connection scheme</p>


      <div class="feedback">
      Copyright (c) 2002-2017 mikroElektronika. All rights reserved.
      <br>What do you think about this topic ?  <a href="http://www.mikroe.com/en/support/">Send us feedback!</a>
    </div>

    <div class="libstock">Want more examples and libraries?&nbsp;
     <br>Find them on
     <a href="http://www.libstock.com/" target="_blank"><img alt="LibStock - A place for the code" src="img/libstock.gif" border="0" align="absmiddle"></a>
    </div>

  </div><!--/main-->




</body>

</html>
